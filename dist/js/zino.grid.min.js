(function(d,p){function u(){this.sortCache={}}var A={dataSource:null,caption:!1,rowCountList:[5,10,20,30,40,50,100],selectMode:"multiRow",selectData:[],width:530,height:200};u.prototype={_attachGrid:function(a,b){if(this._getInst(a))return!1;var c,e,f,q,v,y,r,w,t,l,u,z,x,g=d(a),n=this,k=n._newInst(g);d.extend(k.settings,A,b);x=k.settings.dataSource.sort();null!==x&&k.settings.dataSource.opts.fields.forEach(function(a){n.sortCache[a.name]="ASC";x.forEach(function(b){a.name===b.field&&(n.sortCache[a.name]=
b.direction.toUpperCase())})});g.addClass("zui-grid").css({height:k.settings.height,width:k.settings.width});k.settings.dataSource.load(function(b){var m=k.settings.dataSource,h=m.opts.fields;g.html("");v=(this.uiGrid=d('<table cellspacing="0" cellpadding="0">')).addClass("zui-grid-table").appendTo(a);!1!==k.settings.caption&&d("<caption>").html(k.settings.caption).appendTo(v);y=d("<thead>").appendTo(v);t=d("<tr>").appendTo(y);w=d("<tbody>").appendTo(v);u=d("<tfoot>").appendTo(v);var n=m.sort();c=
0;for(e=h.length;c<e;c++)r=d("<th>").data("field",h[c]).appendTo(t),h[c].sortable!==p&&!1===h[c].sortable||r.addClass("zui-unselectable zui-grid-sortable"),null!==n&&n.forEach(function(a){a.field===h[c].name&&r.addClass("ASC"===a.direction?"zui-grid-up":"zui-grid-down")}),"string"===typeof h[c]?r.html(h[c]):h[c].label===p?r.html(h[c].name):r.html(h[c].label);c=0;for(e=b.length;c<e;c++)for(t=d("<tr>").addClass("zui-grid-row zui-grid-row-"+(0===c%2?"even":"odd")).attr("data-id",b[c]._zuid_).appendTo(w),
f=0,q=h.length;f<q;f++)l=d("<td>").html(b[c][h[f].name]).appendTo(t);k.settings.selectData.forEach(function(a){w.find('.zui-grid-row[data-id="'+a[0]+'"]').addClass("zui-grid-row-selected")});t=d("<tr>").appendTo(u);l=d("<td>").attr("colSpan",h.length).appendTo(t);d("<button>").html("First").attr("title","First").addClass("zui-grid-button zui-grid-first").prop("disabled",1===m.page()).appendTo(l);d("<button>").html("Prev").attr("title","Prev").addClass("zui-grid-button zui-grid-prev").prop("disabled",
1===m.page()).appendTo(l);d("<button>").html("Next").attr("title","Next").addClass("zui-grid-button zui-grid-next").prop("disabled",m.pages()===m.page()).appendTo(l);d("<button>").html("Last").attr("title","Last").addClass("zui-grid-button zui-grid-last").prop("disabled",m.pages()===m.page()).appendTo(l);d("<button>").html("Refresh").attr("title","Refresh").addClass("zui-grid-button zui-grid-refresh").appendTo(l);d("<button>").html("Go to").attr("title","Go to").addClass("zui-grid-button zui-grid-goto").appendTo(l);
d('<input type="text">').addClass("zui-grid-input zui-grid-page").val(m.page()).appendTo(l);d("<span>").html([" / ",m.pages()].join("")).addClass("zui-grid-i").appendTo(l);z=d("<select>").addClass("zui-grid-select zui-grid-rowcount").appendTo(l);k.settings.rowCountList.forEach(function(a){d("<option>").val(a).text(a).prop("selected",m.rowCount()===a).appendTo(z)})});g.on("click",".zui-grid-sortable",function(){var a=d(this).data("field");n.sortCache[a.name]="ASC"===n.sortCache[a.name]?"DESC":"ASC";
g.zinoGrid("sort",[{field:a.name,direction:n.sortCache[a.name]}])}).on("click",".zui-grid-row",function(){g.zinoGrid("select",d(this).data("id"))}).on("click",".zui-grid-first",function(){g.zinoGrid("first")}).on("click",".zui-grid-prev",function(){g.zinoGrid("prev")}).on("click",".zui-grid-next",function(){g.zinoGrid("next")}).on("click",".zui-grid-last",function(){g.zinoGrid("last")}).on("click",".zui-grid-refresh",function(){g.zinoGrid("refresh")}).on("change",".zui-grid-rowcount",function(){g.zinoGrid("rowCount",
d(this).find("option:selected").val())}).on("click",".zui-grid-goto",function(){g.zinoGrid("page",g.find(".zui-grid-page").val())}).on("keypress",".zui-grid-page",function(a){a=a.keyCode||a.which;if(13===a)g.zinoGrid("page",d(this).val());else if(!(48<=a&&57>=a))return!1});d.data(a,"grid",k)},_addGrid:function(a,b){var c=this._getInst(a);if(!c)return!1;if(d.isArray(b))for(var e=0,f=b.length;e<f;e+=1)c.settings.dataSource.add(b[e]);else c.settings.dataSource.add(b)},_removeGrid:function(a){var b=this._getInst(a);
if(!b)return!1;var c,d,f;switch(arguments.length){case 1:f=b.settings.selectData;b.settings.selectData=[];c=0;for(d=f.length;c<d;c+=1)b.settings.dataSource.removeById(f[c][0]);break;case 2:if(/\D/.test(arguments[1])){c=0;for(d=b.settings.selectData.length;c<d;c+=1)b.settings.selectData[c][0]===arguments[1]&&b.settings.selectData.splice(c,1);b.settings.dataSource.removeById(arguments[1])}else{if(f=b.settings.dataSource.getByIndex(arguments[1]))for(c=0,d=b.settings.selectData.length;c<d;c+=1)b.settings.selectData[c][0]===
f._zuid_&&b.settings.selectData.splice(c,1);b.settings.dataSource.removeByIndex(arguments[1])}}},_clearGrid:function(a){var b=this._getInst(a);if(!b)return!1;d(a).find("tbody .zui-grid-row").removeClass("zui-grid-row-selected");b.settings.selectData=[]},_selectGrid:function(a){var b=this._getInst(a);if(!b)return!1;var c,e,f;switch(arguments.length){case 2:/\D/.test(arguments[1])?e=arguments[1]:f=arguments[1];break;default:return}c=d(a).find("tbody .zui-grid-row");switch(b.settings.selectMode){case "singleRow":c.removeClass("zui-grid-row-selected");
e!==p?c.filter('[data-id="'+e+'"]').addClass("zui-grid-row-selected"):f!==p&&(e=c.eq(f).addClass("zui-grid-row-selected").data("id"));b.settings.selectData=[[e]];break;case "multiRow":var q=-1;b.settings.selectData.forEach(function(a,b){a[0]===e&&(q=b)});-1===q?(e!==p?c.filter('[data-id="'+e+'"]').addClass("zui-grid-row-selected"):f!==p&&(e=c.eq(f).addClass("zui-grid-row-selected").data("id")),b.settings.selectData.push([e])):(e!==p?c.filter('[data-id="'+e+'"]').removeClass("zui-grid-row-selected"):
f!==p&&c.eq(f).removeClass("zui-grid-row-selected"),b.settings.selectData.splice(q,1))}},_firstGrid:function(a){a=this._getInst(a);if(!a)return!1;1<a.settings.dataSource.page()&&a.settings.dataSource.page(1).refresh()},_prevGrid:function(a){a=this._getInst(a);if(!a)return!1;var b=a.settings.dataSource.page();1<b&&a.settings.dataSource.page(b-1).refresh()},_nextGrid:function(a){a=this._getInst(a);if(!a)return!1;var b=a.settings.dataSource.page();b<a.settings.dataSource.pages()&&a.settings.dataSource.page(b+
1).refresh()},_lastGrid:function(a){a=this._getInst(a);if(!a)return!1;a.settings.dataSource.page()<a.settings.dataSource.pages()&&a.settings.dataSource.page(a.settings.dataSource.pages()).refresh()},_pageGrid:function(a){var b=this._getInst(a);if(!b)return!1;if(1===arguments.length)return b.settings.dataSource.page();if(b.settings.dataSource.page()!=arguments[1]){var c=b.settings.dataSource.pages();b.settings.dataSource.page(arguments[1]>c?c:1>arguments[1]?1:arguments[1]).refresh()}},_rowCountGrid:function(a){var b=
this._getInst(a);if(!b)return!1;if(1===arguments.length)return b.settings.dataSource.rowCount();b.settings.dataSource.rowCount(arguments[1]).refresh()},_refreshGrid:function(a){a=this._getInst(a);if(!a)return!1;a.settings.dataSource.page(a.settings.dataSource.page()).refresh()},_sortGrid:function(a){var b=this._getInst(a);if(!b)return!1;if(1===arguments.length)return b.settings.dataSource.sort();b.settings.dataSource.sort(arguments[1]).refresh()},_newInst:function(a){return{id:a[0].id.replace(/([^A-Za-z0-9_-])/g,
"\\\\$1"),input:a,uid:Math.floor(99999999*Math.random()),isDisabled:!1,settings:{}}},_getInst:function(a){try{return d.data(a,"grid")}catch(b){throw"Missing instance data for this grid";}}};d.fn.zinoGrid=function(a){var b=Array.prototype.slice.call(arguments,1);return"string"==typeof a&&"isDisabled"==a||"option"==a&&2==arguments.length&&"string"==typeof arguments[1]?d.zinoGrid["_"+a+"Grid"].apply(d.zinoGrid,[this[0]].concat(b)):this.each(function(){"string"==typeof a?d.zinoGrid["_"+a+"Grid"].apply(d.zinoGrid,
[this].concat(b)):d.zinoGrid._attachGrid(this,a)})};d.zinoGrid=new u;d.zinoGrid.version="1.5"})(jQuery);
