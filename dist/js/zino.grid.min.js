!function(v,w){"use strict";var e="grid",S=!1,G={dataSource:null,caption:!1,rowCountList:[5,10,20,30,40,50,100],selectMode:"multiRow",selectData:[],width:530,height:200};function t(){this.sortCache={}}t.prototype={_attachGrid:function(s,t){if(this._getInst(s))return S;var r,n,d,o,g,u,c,l,p,f,h,i,z=v(s),a=this,C=a._newInst(z);v.extend(C.settings,G,t),null!==(i=C.settings.dataSource.sort())&&C.settings.dataSource.opts.fields.forEach(function(e){a.sortCache[e.name]="ASC",i.forEach(function(t){e.name===t.field&&(a.sortCache[e.name]=t.direction.toUpperCase())})}),z.addClass("zui-grid").css({height:C.settings.height,width:C.settings.width}),C.settings.dataSource.load(function(t){var e=C.settings.dataSource,i=e.opts.fields,a=(z.html(""),g=(this.uiGrid=v('<table cellspacing="0" cellpadding="0">')).addClass("zui-grid-table").appendTo(s),!1!==C.settings.caption&&v("<caption>").html(C.settings.caption).appendTo(g),f=v("<thead>").appendTo(g),l=v("<tr>").appendTo(f),c=v("<tbody>").appendTo(g),f=v("<tfoot>").appendTo(g),e.sort());for(r=0,n=i.length;r<n;r++)u=v("<th>").data("field",i[r]).appendTo(l),i[r].sortable!==w&&!1===i[r].sortable||u.addClass("zui-unselectable zui-grid-sortable"),null!==a&&a.forEach(function(t){t.field===i[r].name&&u.addClass("ASC"===t.direction?"zui-grid-up":"zui-grid-down")}),"string"==typeof i[r]?u.html(i[r]):i[r].label===w?u.html(i[r].name):u.html(i[r].label);for(r=0,n=t.length;r<n;r++)for(l=v("<tr>").addClass("zui-grid-row zui-grid-row-"+(r%2==0?"even":"odd")).attr("data-id",t[r]._zuid_).appendTo(c),d=0,o=i.length;d<o;d++)p=v("<td>").html(t[r][i[d].name]).appendTo(l);C.settings.selectData.forEach(function(t){c.find('.zui-grid-row[data-id="'+t[0]+'"]').addClass("zui-grid-row-selected")}),l=v("<tr>").appendTo(f),p=v("<td>").attr("colSpan",i.length).appendTo(l),v("<button>").html("First").attr("title","First").addClass("zui-grid-button zui-grid-first").prop("disabled",1===e.page()).appendTo(p),v("<button>").html("Prev").attr("title","Prev").addClass("zui-grid-button zui-grid-prev").prop("disabled",1===e.page()).appendTo(p),v("<button>").html("Next").attr("title","Next").addClass("zui-grid-button zui-grid-next").prop("disabled",e.pages()===e.page()).appendTo(p),v("<button>").html("Last").attr("title","Last").addClass("zui-grid-button zui-grid-last").prop("disabled",e.pages()===e.page()).appendTo(p),v("<button>").html("Refresh").attr("title","Refresh").addClass("zui-grid-button zui-grid-refresh").appendTo(p),v("<button>").html("Go to").attr("title","Go to").addClass("zui-grid-button zui-grid-goto").appendTo(p),v('<input type="text">').addClass("zui-grid-input zui-grid-page").val(e.page()).appendTo(p),v("<span>").html([" / ",e.pages()].join("")).addClass("zui-grid-i").appendTo(p),h=v("<select>").addClass("zui-grid-select zui-grid-rowcount").appendTo(p),C.settings.rowCountList.forEach(function(t){v("<option>").val(t).text(t).prop("selected",e.rowCount()===t).appendTo(h)})}),z.on("click",".zui-grid-sortable",function(){var t=v(this).data("field");a.sortCache[t.name]="ASC"===a.sortCache[t.name]?"DESC":"ASC",z.zinoGrid("sort",[{field:t.name,direction:a.sortCache[t.name]}])}).on("click",".zui-grid-row",function(){z.zinoGrid("select",v(this).data("id"))}).on("click",".zui-grid-first",function(){z.zinoGrid("first")}).on("click",".zui-grid-prev",function(){z.zinoGrid("prev")}).on("click",".zui-grid-next",function(){z.zinoGrid("next")}).on("click",".zui-grid-last",function(){z.zinoGrid("last")}).on("click",".zui-grid-refresh",function(){z.zinoGrid("refresh")}).on("change",".zui-grid-rowcount",function(){z.zinoGrid("rowCount",v(this).find("option:selected").val())}).on("click",".zui-grid-goto",function(){z.zinoGrid("page",z.find(".zui-grid-page").val())}).on("keypress",".zui-grid-page",function(t){t=t.keyCode||t.which;if(13===t)z.zinoGrid("page",v(this).val());else if(!(48<=t&&t<=57))return!1}),v.data(s,e,C)},_addGrid:function(t,e){var i=this._getInst(t);if(!i)return S;if(v.isArray(e))for(var a=0,s=e.length;a<s;a+=1)i.settings.dataSource.add(e[a]);else i.settings.dataSource.add(e)},_removeGrid:function(t){var e,i,a,s=this._getInst(t);if(!s)return S;switch(arguments.length){case 1:for(a=s.settings.selectData,s.settings.selectData=[],e=0,i=a.length;e<i;e+=1)s.settings.dataSource.removeById(a[e][0]);break;case 2:if(/\D/.test(arguments[1])){for(e=0,i=s.settings.selectData.length;e<i;e+=1)s.settings.selectData[e][0]===arguments[1]&&s.settings.selectData.splice(e,1);s.settings.dataSource.removeById(arguments[1])}else{if(a=s.settings.dataSource.getByIndex(arguments[1]))for(e=0,i=s.settings.selectData.length;e<i;e+=1)s.settings.selectData[e][0]===a._zuid_&&s.settings.selectData.splice(e,1);s.settings.dataSource.removeByIndex(arguments[1])}}},_clearGrid:function(t){var e=this._getInst(t);if(!e)return S;v(t).find("tbody .zui-grid-row").removeClass("zui-grid-row-selected"),e.settings.selectData=[]},_selectGrid:function(t){var e,i,a,s=this._getInst(t);if(!s)return S;if(2===arguments.length)switch(/\D/.test(arguments[1])?i=arguments[1]:a=arguments[1],e=v(t).find("tbody .zui-grid-row"),s.settings.selectMode){case"singleRow":e.removeClass("zui-grid-row-selected"),i!==w?e.filter('[data-id="'+i+'"]').addClass("zui-grid-row-selected"):a!==w&&(i=e.eq(a).addClass("zui-grid-row-selected").data("id")),s.settings.selectData=[[i]];break;case"multiRow":var r=-1;s.settings.selectData.forEach(function(t,e){t[0]===i&&(r=e)}),-1===r?(i!==w?e.filter('[data-id="'+i+'"]').addClass("zui-grid-row-selected"):a!==w&&(i=e.eq(a).addClass("zui-grid-row-selected").data("id")),s.settings.selectData.push([i])):(i!==w?e.filter('[data-id="'+i+'"]').removeClass("zui-grid-row-selected"):a!==w&&e.eq(a).removeClass("zui-grid-row-selected"),s.settings.selectData.splice(r,1))}},_firstGrid:function(t){t=this._getInst(t);if(!t)return S;1<t.settings.dataSource.page()&&t.settings.dataSource.page(1).refresh()},_prevGrid:function(t){t=this._getInst(t);if(!t)return S;var e=t.settings.dataSource.page();1<e&&t.settings.dataSource.page(e-1).refresh()},_nextGrid:function(t){t=this._getInst(t);if(!t)return S;var e=t.settings.dataSource.page();e<t.settings.dataSource.pages()&&t.settings.dataSource.page(e+1).refresh()},_lastGrid:function(t){t=this._getInst(t);if(!t)return S;t.settings.dataSource.page()<t.settings.dataSource.pages()&&t.settings.dataSource.page(t.settings.dataSource.pages()).refresh()},_pageGrid:function(t){var e,t=this._getInst(t);return t?1===arguments.length?t.settings.dataSource.page():void(t.settings.dataSource.page()!=arguments[1]&&(e=t.settings.dataSource.pages(),t.settings.dataSource.page(e<arguments[1]?e:arguments[1]<1?1:arguments[1]).refresh())):S},_rowCountGrid:function(t){t=this._getInst(t);return t?1===arguments.length?t.settings.dataSource.rowCount():void t.settings.dataSource.rowCount(arguments[1]).refresh():S},_refreshGrid:function(t){t=this._getInst(t);if(!t)return S;t.settings.dataSource.page(t.settings.dataSource.page()).refresh()},_sortGrid:function(t){t=this._getInst(t);return t?1===arguments.length?t.settings.dataSource.sort():void t.settings.dataSource.sort(arguments[1]).refresh():S},_newInst:function(t){return{id:t[0].id.replace(/([^A-Za-z0-9_-])/g,"\\\\$1"),input:t,uid:Math.floor(99999999*Math.random()),isDisabled:S,settings:{}}},_getInst:function(t){try{return v.data(t,e)}catch(t){throw"Missing instance data for this grid"}}},v.fn.zinoGrid=function(t){var e=Array.prototype.slice.call(arguments,1);return"string"==typeof t&&"isDisabled"===t||"option"===t&&2===arguments.length&&"string"==typeof arguments[1]?v.zinoGrid["_"+t+"Grid"].apply(v.zinoGrid,[this[0]].concat(e)):this.each(function(){"string"==typeof t?v.zinoGrid["_"+t+"Grid"].apply(v.zinoGrid,[this].concat(e)):v.zinoGrid._attachGrid(this,t)})},v.zinoGrid=new t,v.zinoGrid.version="1.5"}(jQuery);