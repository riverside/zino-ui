!function(t,i){"use strict";var s={autoLoad:!1,data:[],dataType:"array",dataUrl:null,fields:[],page:1,rowCount:20,xmlRoot:null,xmlRecord:null,filter:null,sort:null,change:null};function e(t){return this instanceof e?(this._offset=0,this._pages=0,this._total=0,this.originalData=[],this._view=[],this.cache=!1,this.callback=null,this.init.call(this,t),this):new e(t)}function a(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}function o(){var o=arguments;return function(t,s){for(var a=0,i=0,e=o.length;0===i&&a<e;)i=function(a){var i=1;return"-"===a[0]&&(i=-1,a=a.substr(1,a.length-1)),function(t,s){return(t[a]<s[a]?-1:t[a]>s[a]?1:0)*i}}(o[a])(t,s),a++;return i}}e.guid=function(){return[a(),a(),"-",a(),"-",a(),"-",a(),"-",a(),a(),a()].join("")},e.prototype={add:function(t){if(t===i)throw new Error("Data item is undefined");return t._zuid_=e.guid(),this.opts.data.push(t),this._total=this.opts.data.length,this._pages=Math.ceil(this._total/this.opts.rowCount),this._offset=(parseInt(this.opts.page,10)-1)*this.opts.rowCount,this.refresh.call(this),this},cancel:function(){return this.opts.data=this.originalData,$(this).trigger("datasourcechange",{}),this},data:function(){return 0===arguments.length?this.opts.data:(this.opts.data=arguments[0],this)},filter:function(){return 0===arguments.length?this.opts.filter:(this.opts.filter=arguments[0],this._filter.call(this),this)},getById:function(t){for(var s=0,a=this.opts.data.length;s<a;s++)if(this.opts.data[s]._zuid_===t)return this.opts.data[s];return null},getByIndex:function(t){return this.opts.data[t]!==i?this.opts.data[t]:null},init:function(t){var a=this;this.opts=$.extend(s,t),$(this).bind("datasourcechange",function(t,s){null!==a.opts.change&&a.opts.change.call(this,t,s)}),this.opts.autoLoad&&this.load.call(this)},insert:function(t,s){if(s===i)throw new Error("Data item is undefined");return this.opts.data.splice(t,0,s),this.refresh.call(this),this},load:function(s){var o=this;function a(t){for(var s=0,a=t.length;s<a;s++)t[s]._zuid_=e.guid();return t}switch(s!==i&&"function"==typeof s&&(o.callback=s),this.opts.dataType){case"json":$.get(this.opts.dataUrl).done(function(t){o._total=t.length,o._pages=Math.ceil(o._total/o.opts.rowCount),o._offset=(parseInt(o.opts.page,10)-1)*o.opts.rowCount,o.opts.data=a(t),o._sort.call(o),o._view=o.opts.data.slice(o._offset,o._offset+o.opts.rowCount),o.originalData=o.opts.data,s!==i&&"function"==typeof s&&s.call(o,o._view)});break;case"xml":$.get(this.opts.dataUrl).done(function(t){var e=[];$(t).find(o.opts.xmlRoot).find(o.opts.xmlRecord).each(function(i,t){e.push({}),$(t).children().each(function(t,s){for(var t=0,a=o.opts.fields.length;t<a;t++)if("object"==typeof o.opts.fields[t]){if(this.nodeName===o.opts.fields[t].name){e[i][this.nodeName]=function(t,s){switch(s.toLowerCase()){case"int":case"integer":case"numeric":return parseInt(t,10);case"bool":case"boolean":if("true"===t.toLowerCase()||"1"===t||1===t)return!0;if("false"===t.toLowerCase()||"0"===t||0===t)return!1;break;case"string":return t.toString();case"float":case"decimal":return parseFloat(t);case"date":return new Date(t)}}($(s).text(),o.opts.fields[t].type);break}}else e[i][this.nodeName]=$(s).text()})}),o._total=e.length,o._pages=Math.ceil(o._total/o.opts.rowCount),o._offset=(parseInt(o.opts.page,10)-1)*o.opts.rowCount,o.opts.data=e.slice(o._offset,o._offset+o.opts.rowCount),o.opts.data=a(o.opts.data),o.originalData=o.opts.data,o._sort.call(o),s!==i&&"function"==typeof s&&s.call(o,o.opts.data)});break;default:this._total=this.opts.data.length,this.opts.data=a(this.opts.data),this.originalData=this.opts.data,this._sort.call(this),s!==i&&"function"==typeof s&&s.call(this,this.opts.data)}return $(this).trigger("datasourcechange",{}),this},page:function(){return 0===arguments.length?this.opts.page:(this.opts.page=parseInt(arguments[0],10),this)},pages:function(){return this._pages},refresh:function(){return this.callback!==i&&null!==this.callback&&"function"==typeof this.callback&&(this._offset=(parseInt(this.opts.page,10)-1)*this.opts.rowCount,this._view=this.opts.data.slice(this._offset,this._offset+this.opts.rowCount),this._pages=Math.ceil(this._total/this.opts.rowCount),this.callback.call(this,this._view)),this},remove:function(t){if(t===i)throw new Error("Data item is undefined");for(var s=0,a=this.opts.data.length;s<a;s++)if(JSON.stringify(t)===JSON.stringify(this.opts.data[s])){this.opts.data.splice(s,1);break}return this._total=this.opts.data.length,this._pages=Math.ceil(this._total/this.opts.rowCount),this._offset=(parseInt(this.opts.page,10)-1)*this.opts.rowCount,this.refresh.call(this),this},removeById:function(t){for(var s=0,a=this.opts.data.length;s<a;s++)if(this.opts.data[s]._zuid_===t){this.opts.data.splice(s,1);break}return this._total=this.opts.data.length,this._pages=Math.ceil(this._total/this.opts.rowCount),this._offset=(parseInt(this.opts.page,10)-1)*this.opts.rowCount,this.refresh.call(this),this},removeByIndex:function(t){return this.opts.data.splice(t,1),this._total=this.opts.data.length,this._pages=Math.ceil(this._total/this.opts.rowCount),this._offset=(parseInt(this.opts.page,10)-1)*this.opts.rowCount,this.refresh.call(this),this},rowCount:function(){return 0===arguments.length?this.opts.rowCount:(this.opts.rowCount=parseInt(arguments[0],10),this)},sort:function(){return 0===arguments.length?this.opts.sort:(this.opts.sort=arguments[0],this._sort.call(this),this)},total:function(){return this._total},_filter:function(){var s,a,i,e=this.opts.filter,o=e.length;this.opts.data=$.grep(this.originalData,function(t){for(a=[],s=0;s<o;s++)switch(a[s]=!1,e[s].operator){case"start":i="^"+e[s].value,null!==t[e[s].field].toString().match(i)&&(a[s]=!0);break;case"end":i=e[s].value+"$",null!==t[e[s].field].toString().match(i)&&(a[s]=!0);break;case"lt":case"<":t[e[s].field]<e[s].value&&(a[s]=!0);break;case"lte":case"le":case"<=":t[e[s].field]<=e[s].value&&(a[s]=!0);break;case"gt":case">":t[e[s].field]>e[s].value&&(a[s]=!0);break;case"gte":case"ge":case">=":t[e[s].field]>=e[s].value&&(a[s]=!0);break;case"ne":case"neq":case"!=":t[e[s].field]!=e[s].value&&(a[s]=!0);break;default:t[e[s].field]==e[s].value&&(a[s]=!0)}return-1===$.inArray(!1,a)})},_sort:function(){var t,s,a=[];if(null===this.opts.sort||0===this.opts.sort.length)return!1;for(t=0,s=this.opts.sort.length;t<s;t++)a.push("ASC"===this.opts.sort[t].direction.toUpperCase()?this.opts.sort[t].field:"-"+this.opts.sort[t].field);this.opts.data.sort(o.apply(null,a))}},t.zino=t.zino||{},t.zino.DataSource=e}(window);