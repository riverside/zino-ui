!function(p){"use strict";var g="selectbox",h=!1;function e(){this._state=[],this._defaults={classHolder:"zui-selectbox-holder",classHolderDisabled:"zui-selectbox-holder-disabled",classSelector:"zui-selectbox-selector",classOptions:"zui-selectbox-options",classGroup:"zui-selectbox-group",classSub:"zui-selectbox-sub",classDisabled:"zui-selectbox-disabled",classToggleOpen:"zui-selectbox-toggle-open",classToggle:"zui-selectbox-toggle",classFocus:"zui-selectbox-focus",speed:200,effect:"slide",enable:null,disable:null,change:null,open:null,close:null}}e.prototype={_isOpenSelectbox:function(e){return e?this._getInst(e).isOpen:h},_isDisabledSelectbox:function(e){return e?this._getInst(e).isDisabled:h},_attachSelectbox:function(a,e){if(this._getInst(a))return h;var o,c,d,t=p(a),s=t.offset(),u=this,r=u._newInst(t),b=h,i=(t.find("optgroup"),t.find("option"));i.length;function n(){var e,t,s=this.attr("id").split("_")[1];for(e in u._state)e!==s&&u._state.hasOwnProperty(e)&&(t=p("select[sb='"+e+"']")[0])&&u._closeSelectbox(t)}function l(e,t){var n=!(!t||!t.sub),l=!(!t||!t.disabled);e.each(function(e){var t,s=p(this),i=p("<li>");s.is(":selected")&&(o.text(s.text()),b=!0),s.is(":disabled")||l?(t=p("<span>",{text:s.text()}).addClass(r.settings.classDisabled),n&&t.addClass(r.settings.classSub)):(t=p("<a>",{href:"#"+s.val(),rel:s.val()}).text(s.text()).bind("click.sb",function(e){e&&e.preventDefault&&e.preventDefault();var e=c,t=p(this);e.attr("id").split("_")[1];u._changeSelectbox(a,t.attr("rel"),t.text()),u._closeSelectbox(a)}).bind("mouseover.sb",function(){var e=p(this);e.parent().siblings().find("a").removeClass(r.settings.classFocus),e.addClass(r.settings.classFocus)}).bind("mouseout.sb",function(){p(this).removeClass(r.settings.classFocus)}),n&&t.addClass(r.settings.classSub),s.is(":selected")&&t.addClass(r.settings.classFocus)),t.appendTo(i),i.appendTo(d)})}t.attr("sb",r.uid),p.extend(r.settings,u._defaults,e),u._state[r.uid]=h,t.bind("selectboxenable",function(e,t){null!==r.settings.enable&&r.settings.enable.call(a,e,t)}).bind("selectboxdisable",function(e,t){null!==r.settings.disable&&r.settings.disable.call(a,e,t)}).bind("selectboxopen",function(e,t){null!==r.settings.open&&r.settings.open.call(a,e,t)}).bind("selectboxchange",function(e,t){null!==r.settings.change&&r.settings.change.call(a,e,t)}).bind("selectboxclose",function(e,t){null!==r.settings.close&&r.settings.close.call(a,e,t)}),e=p("<div>",{id:"sbHolder_"+r.uid,class:r.settings.classHolder,tabindex:t.attr("tabindex"),"aria-expanded":!1}).css({position:"absolute",top:s.top+"px",left:s.left+"px"}),o=p("<a>",{id:"sbSelector_"+r.uid,href:"#",click:function(e){e.preventDefault(),n.apply(p(this),[]);e=p(this).attr("id").split("_")[1];u._state[e]?u._closeSelectbox(a):u._openSelectbox(a)}}).addClass(r.settings.classSelector).addClass("zui-unselectable"),(c=p("<a>",{id:"sbToggle_"+r.uid,href:"#",class:r.settings.classToggle,click:function(e){e.preventDefault(),n.apply(p(this),[]);e=p(this).attr("id").split("_")[1];u._state[e]?u._closeSelectbox(a):u._openSelectbox(a)}})).appendTo(e),d=p("<ul>",{id:"sbOptions_"+r.uid,class:r.settings.classOptions,css:{display:"none"}}),t.children().each(function(e){var t,s=p(this),i={};s.is("option")?l.call(null,s):s.is("optgroup")&&(t=p("<li>"),p("<span>",{text:s.attr("label")}).addClass(r.settings.classGroup).appendTo(t),t.appendTo(d),s.is(":disabled")&&(i.disabled=!0),i.sub=!0,l.call(null,s.find("option"),i))}),b||o.text(i.first().text()),p.data(a,g,r),e.data("uid",r.uid).bind("keydown.sb",function(e){var t=e.charCode||e.keyCode||0,s=p(this),i=s.data("uid"),n=s.siblings("select[sb='"+i+"']").data(g),l=s.siblings(["select[sb='",i,"']"].join("")).get(0),a=s.find("ul").find("a."+n.settings.classFocus);switch(t){case 37:case 38:0<a.length&&(p("a",s).removeClass(n.settings.classFocus),0<(o=a.parent().prevAll("li:has(a)").eq(0).find("a")).length)&&(o.addClass(n.settings.classFocus).focus(),p("#sbSelector_"+i).text(o.text()));break;case 39:case 40:p("a",s).removeClass(n.settings.classFocus),0<(o=0<a.length?a.parent().nextAll("li:has(a)").eq(0).find("a"):s.find("ul").find("a").eq(0)).length&&(o.addClass(n.settings.classFocus).focus(),p("#sbSelector_"+i).text(o.text()));break;case 13:0<a.length&&u._changeSelectbox(l,a.attr("rel"),a.text()),u._closeSelectbox(l);break;case 9:l&&u._getInst(l)&&(0<a.length&&u._changeSelectbox(l,a.attr("rel"),a.text()),u._closeSelectbox(l));var o=parseInt(s.attr("tabindex"),10);e.shiftKey?o--:o++,p("*[tabindex='"+o+"']").focus();break;case 27:u._closeSelectbox(l)}return e.stopPropagation(),!1}).delegate("a","mouseover.sb",function(e){p(this).addClass(r.settings.classFocus)}).delegate("a","mouseout.sb",function(e){p(this).removeClass(r.settings.classFocus)}),o.appendTo(e),d.appendTo(e),e.appendTo(document.body),t.css({"data-width":t.width(),"data-height":t.height()}).css({visibility:"hidden",width:e.outerWidth()+"px",height:e.outerHeight()+"px"}),p(window).delegate("html","mousedown.sb",function(e){e.stopPropagation(),p("select").zinoSelectbox("close")}),p([".",r.settings.classHolder,", .",r.settings.classSelector].join("")).mousedown(function(e){e.stopPropagation()}),t.is(":disabled")&&u._disableSelectbox(a)},_destroySelectbox:function(e){var t=this._getInst(e);if(!t)return h;p("#sbHolder_"+t.uid).remove(),p.data(e,g,null);t=p(e);t.css({visibility:"visible",width:t.data("width")+"px",height:t.data("height")+"px"}).removeAttr("sb")},_changeSelectbox:function(e,t,s){var i=this._getInst(e);i&&p("#sbSelector_"+i.uid).text(s),t=t.replace(/\'/g,"\\'"),p(e).find("option[value='"+t+"']").prop("selected",!0),i&&p(e).trigger("selectboxchange",{input:i.input?i.input[0]:null,value:t,text:s})},_enableSelectbox:function(e){var t=this._getInst(e);if(!t||!t.isDisabled)return h;p("#sbHolder_"+t.uid).removeClass(t.settings.classHolderDisabled),t.isDisabled=h,p(e).trigger("selectboxenable",{input:t.input?t.input[0]:null}),p.data(e,g,t)},_disableSelectbox:function(e){var t=this._getInst(e);if(!t||t.isDisabled)return h;p("#sbHolder_"+t.uid).addClass(t.settings.classHolderDisabled),t.isDisabled=!0,p(e).trigger("selectboxdisable",{input:t.input?t.input[0]:null}),p.data(e,g,t)},_optionSelectbox:function(e,t,s){var i=this._getInst(e);if(!i)return h;i[t]=s,p.data(e,g,i)},_openSelectbox:function(e){var t,s,i,n,l,a,o=this._getInst(e);!o||o.isOpen||o.isDisabled||(t=p("#sbOptions_"+o.uid),a=parseInt(p(window).height(),10),i=(s=p("#sbHolder_"+o.uid)).offset(),n=p(window).scrollTop(),l=t.prev().height(),a=a-(i.top-n)-l/2,s.attr("aria-expanded",!0),t.css({top:l+"px",maxHeight:a-l+"px"}),"fade"===o.settings.effect?t.fadeIn(o.settings.speed):t.slideDown(o.settings.speed),p("#sbToggle_"+o.uid).addClass(o.settings.classToggleOpen),this._state[o.uid]=!0,o.isOpen=!0,p(e).trigger("selectboxopen",{input:o.input?o.input[0]:null}),p.data(e,g,o))},_closeSelectbox:function(e){var t=this._getInst(e);t&&t.isOpen&&("fade"===t.settings.effect?p("#sbOptions_"+t.uid).fadeOut(t.settings.speed):p("#sbOptions_"+t.uid).slideUp(t.settings.speed),p("#sbToggle_"+t.uid).removeClass(t.settings.classToggleOpen),p("#sbHolder_"+t.uid).attr("aria-expanded",!1),this._state[t.uid]=h,t.isOpen=h,p(e).trigger("selectboxclose",{input:t.input?t.input[0]:null}),p.data(e,g,t))},_newInst:function(e){return{id:e[0].id.replace(/([^A-Za-z0-9_-])/g,"\\\\$1"),input:e,uid:Math.floor(99999999*Math.random()),isOpen:h,isDisabled:h,settings:{}}},_getInst:function(e){try{return p.data(e,g)}catch(e){throw"Missing instance data for this selectbox"}},_get:function(e,t){return(void 0!==e.settings[t]?e.settings:this._defaults)[t]}},p.fn.zinoSelectbox=function(e){var t=Array.prototype.slice.call(arguments,1);return"string"==typeof e&&"isDisabled"===e||"option"===e&&2===arguments.length&&"string"==typeof arguments[1]?p.zinoSelectbox["_"+e+"Selectbox"].apply(p.zinoSelectbox,[this[0]].concat(t)):this.each(function(){"string"==typeof e?p.zinoSelectbox["_"+e+"Selectbox"].apply(p.zinoSelectbox,[this].concat(t)):p.zinoSelectbox._attachSelectbox(this,e)})},p.zinoSelectbox=new e,p.zinoSelectbox.version="1.5"}(jQuery);