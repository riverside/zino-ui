!function(l){"use strict";var u="combobox";function o(){this._defaults={autocomplete:!1,dataSource:null,multiple:!1},this._events={change:null,close:null,open:null,select:null}}o.prototype={_attachCombobox:function(n,o){if(this._getInst(n))return!1;var t,e,s=l(n),a=this,b=a._newInst(s),o=(l.extend(b.settings,a._defaults,a._events,o),s.attr({role:"combobox","aria-expanded":"false","aria-autocomplete":"list","aria-owns":"zui-combobox-listbox-"+b.uid,"aria-activedescendant":""}).addClass("zui-combobox zui-combobox-combo").wrap('<div class="zui-combobox-wrapper zui-unselectable" />').bind("comboboxopen",function(o,t){null!==b.settings.open&&b.settings.open.call(n,o,t)}).bind("comboboxselect",function(o,t){null!==b.settings.select&&b.settings.select.call(n,o,t)}).bind("comboboxchange",function(o,t){null!==b.settings.change&&b.settings.change.call(n,o,t)}).bind("comboboxclose",function(o,t){null!==b.settings.close&&b.settings.close.call(n,o,t)}),s.width()+26),i=s.parent().offset(),c=s.parent();c.css("width",o+"px"),t=l("<div>",{id:"zui-combobox-"+b.uid}).hide().css({position:"absolute",top:i.top+c.height()+1+"px",left:i.left+"px",width:o+"px"}),e=l("<ul>",{role:"listbox",id:"zui-combobox-listbox-"+b.uid}).addClass("zui-combobox-list zui-unselectable"),b.settings.dataSource.load(function(o){for(var t=0,i=o.length;t<i;t++)("object"==typeof this.opts.fields[0]?l("<li>",{role:"option",id:["zui-combobox-option-",b.uid,"-",t].join("")}).addClass("zui-combobox-item").text(o[t][this.opts.fields[0].name]):l("<li>",{role:"option",id:["zui-combobox-option-",b.uid,"-",t].join("")}).addClass("zui-combobox-item").text(o[t][this.opts.fields[0]])).appendTo(e)}),l("<span>").addClass("zui-combobox-trigger zui-unselectable").bind("click.combobox",function(){(t.is(":visible")?a._closeCombobox:a._openCombobox).call(a,n)}).append("<span />").appendTo(s.parent()),e.on("mouseover.combobox",".zui-combobox-item",function(){l(this).addClass("zui-combobox-item-hover")}).on("mouseout.combobox",".zui-combobox-item",function(){l(this).removeClass("zui-combobox-item-hover")}).on("click.combobox",".zui-combobox-item",function(){var o,t,i,e=l(this);b.settings.multiple?(s.val(),o=e.text(),(void 0===(t=s.data("stack"))?(s.data("stack",[o]),s.val(o)):(-1===(i=l.inArray(o,t))?t.push(o):t.splice(i,1),s.data("stack",t).val(t.join(", ")))).focus()):(a._selectCombobox.call(a,n,e.index()),a._closeCombobox.call(a,n))}),b.settings.autocomplete&&c.on("keyup.combobox",s,function(){var o=s.val();0<o.length?l("li",e).show().not("li:contains('"+o+"')").hide():l("li",e).show(),t.is(":visible")||a._openCombobox.call(a,n)}),e.appendTo(t),t.appendTo(document.body),l(window).off(".combobox").on("mousedown.combobox",document.body,function(o){var t=l(o.target);t.hasClass("zui-combobox-item")||t.hasClass("zui-combobox-trigger")||t.hasClass("zui-combobox")||t.hasClass("zui-combobox-wrapper")||t.hasClass("zui-combobox-list")||(o.stopPropagation(),l(".zui-combobox").zinoCombobox("close"))}),b.list=e,b.container=t,l.data(n,u,b)},_openCombobox:function(o){var t=this._getInst(o);if(!t)return!1;t.container.is(":visible")||(t.container.show(),l(o).attr("aria-expanded","true").trigger("comboboxopen",{}))},_selectCombobox:function(o,t){var i,e=this._getInst(o);if(!e)return!1;l.isNumeric(t)?i=l("li",e.list).eq(t):t instanceof jQuery&&(i=t),i.siblings("li").removeClass("zui-combobox-item-selected").end().addClass("zui-combobox-item-selected"),l(o).trigger("comboboxselect",{index:t,item:i}).attr("aria-activedescendant",["zui-combobox-option-",e.uid,"-",i.index()].join("")).val(i.text()).focus().trigger("comboboxchange",{index:t,item:i})},_closeCombobox:function(o){var t=this._getInst(o);if(!t)return!1;t.container.is(":visible")&&(t.container.hide(),l(o).attr("aria-expanded","false").trigger("comboboxclose",{}))},_newInst:function(o){return{id:o[0].id.replace(/([^A-Za-z0-9_-])/g,"\\\\$1"),input:o,uid:Math.floor(99999999*Math.random()),isDisabled:!1,settings:{}}},_getInst:function(o){try{return l.data(o,u)}catch(o){throw"Missing instance data for this combobox"}}},l.fn.zinoCombobox=function(o){var t=Array.prototype.slice.call(arguments,1);return"string"==typeof o&&"isDisabled"===o||"option"===o&&2===arguments.length&&"string"==typeof arguments[1]?l.zinoCombobox["_"+o+"Combobox"].apply(l.zinoCombobox,[this[0]].concat(t)):this.each(function(){"string"==typeof o?l.zinoCombobox["_"+o+"Combobox"].apply(l.zinoCombobox,[this].concat(t)):l.zinoCombobox._attachCombobox(this,o)})},l.zinoCombobox=new o,l.zinoCombobox.version="1.5"}(jQuery);