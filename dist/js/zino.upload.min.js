!function(s){"use strict";var l="upload",d=!1;function t(){this._defaults={url:"upload.php",method:"PUT",name:"file",label:"Upload",data:{},multiple:!1,autoSubmit:!0,change:null,submit:null,complete:null}}function r(){this.boundary="------ZinoUI"+Math.ceil(9999999*Math.random()),this.data=[]}r.prototype={append:function(t,i){return this.data.push([t,i]),this},toString:function(){for(var t,i="\r\n",a=this.boundary,e=[],n=0,o=this.data.length;n<o;n++)e.push(["--",a,i].join("")),this.data[n][1].name?(t=this.data[n][1],e.push(['Content-Disposition: form-data; name="',this.data[n][0],'"; filename="',t.name,'"',i].join("")),e.push(["Content-Type: ",t.type,i,i].join("")),e.push([t.getAsBinary(),i].join(""))):(e.push(['Content-Disposition: form-data; name="',this.data[n][0],'";',i,i].join("")),e.push([this.data[n][1],i].join("")));return e.push(["--",a,"--"].join("")),e.join("")}},t.prototype={_attachUpload:function(a,t){if(this._getInst(a))return d;var e=s(a),i=this,n=this._newInst(e);if(s.extend(n.settings,this._defaults,t),e.addClass("zui-upload").hover(function(){s(this).addClass("zui-upload-hover")},function(){s(this).removeClass("zui-upload-hover")}),0<n.settings.label.length&&(n.$label=s("<span>").addClass("zui-upload-label").text(n.settings.label),n.$label.appendTo(e)),n.$form=s(['<form method="',n.settings.method,'" action="',n.settings.url,'" enctype="multipart/form-data" encoding="multipart/form-data"><input name="',n.settings.name,'"',n.settings.multiple?' multiple="multiple"':"",' type="file" class="zui-upload-file" /></form>'].join("")),n.$form.addClass("zui-upload-form").bind("submit",function(t){if(window.FormData&&window.FileList){var i,a=new(window.FormData?FormData:r);for(i in window.FileList&&s.each(n.$file[0].files,function(t,i){a.append(n.settings.name,i)}),n.settings.data)n.settings.data.hasOwnProperty(i)&&a.append(i,n.settings.data[i]);return s.ajax({url:n.settings.url,data:a,cache:!1,contentType:!1,processData:!1,type:n.settings.method}).done(function(t){n.$file.removeAttr("disabled"),e.trigger("uploadcomplete",{file:n.$file,response:t})}),!1}n.$iframe.load(function(){n.$file.removeAttr("disabled"),e.trigger("uploadcomplete",{file:n.$file,response:s(this).contents().find("html body").text()}),n.$iframe.unbind()}),s(this).attr("target","zui-upload-iframe-"+n.uid),t.stopPropagation()}).appendTo(e),n.$file=n.$form.find("input[type='file']"),n.$file.bind("change",function(){e.trigger("uploadchange",{file:s(this)}).data("result")!==d&&(n.fileList=this.files,n.settings.autoSubmit)&&i._processUpload.call(i,a)}),!window.FormData||!window.FileList)for(var o in n.$iframe=s('<iframe name="zui-upload-iframe-'+n.uid+'" id="zui-upload-iframe-'+n.uid+'"></iframe>').attr("src","javascript:false").addClass("zui-upload-iframe").hide().appendTo(a),n.settings.data)n.settings.data.hasOwnProperty(o)&&s("<input>",{type:"hidden",name:o,value:n.settings.data[o]}).appendTo(n.$form);e.bind("uploadchange",function(t,i){s(this).data("result",!0),null!==n.settings.change&&n.settings.change.call(a,t,i)}).bind("uploadsubmit",function(t,i){s(this).data("result",!0),null!==n.settings.submit&&n.settings.submit.call(a,t,i)}).bind("uploadcomplete",function(t,i){null!==n.settings.complete&&n.settings.complete.call(a,t,i)}),s.data(a,l,n)},_processUpload:function(t){var i=this._getInst(t);if(!i)return d;s(t).trigger("uploadsubmit",{file:i.$file}).data("result")!==d&&(i.$form.submit(),i.$file.attr("disabled","disabled"))},_destroyUpload:function(t){var i=this._getInst(t),a=s(t);if(!i)return d;i.$form.remove(),i.$iframe.remove(),a.removeClass("zui-upload").find(".zui-upload-label").remove(),s.data(t,l,d)},_optionUpload:function(t,i){var a=this._getInst(t);if(!a)return d;if("string"==typeof i){if(!arguments[2])return a.settings[i];a.settings[i]=arguments[2]}else"object"==typeof i&&s.extend(a.settings,i);s.data(t,l,a)},_newInst:function(t){return{id:t[0].id.replace(/([^A-Za-z0-9_-])/g,"\\\\$1"),input:t,uid:Math.floor(99999999*Math.random()),isDisabled:d,settings:{}}},_getInst:function(t){try{return s.data(t,l)}catch(t){throw"Missing instance data for this upload"}}},s.fn.zinoUpload=function(t){var i=Array.prototype.slice.call(arguments,1);return"string"==typeof t&&"isDisabled"===t||"option"===t&&2===arguments.length&&"string"==typeof arguments[1]?s.zinoUpload["_"+t+"Upload"].apply(s.zinoUpload,[this[0]].concat(i)):this.each(function(){"string"==typeof t?s.zinoUpload["_"+t+"Upload"].apply(s.zinoUpload,[this].concat(i)):s.zinoUpload._attachUpload(this,t)})},s.zinoUpload=new t,s.zinoUpload.version="1.5"}(jQuery);